# プライベートEKSクラスターと管理インスタンスのセットアップ

このTerraform構成は、プライベートエンドポイントを持つAmazon EKS（Elastic Kubernetes Service）クラスターと、クラスターを管理するためのEC2インスタンスを作成します。

## リソース構成

### EKSクラスター
- 設定可能な名前とバージョンを持つEKSクラスター
- プライベートエンドポイントアクセスが有効、パブリックエンドポイントアクセスは無効
- 設定可能なインスタンスタイプとスケーリング設定を持つノードグループ
- 最適化されたAmazon Linux 2 AMIを使用

### ネットワークリソース
- 設定可能なCIDRブロックを持つVPC
- 複数のアベイラビリティゾーンにまたがるサブネット
- インターネットゲートウェイ
- インターネットゲートウェイへのルートを持つルートテーブル
- VPC内からのHTTPS（443）アクセスを許可するEKSクラスター用のセキュリティグループ

### IAMリソース
- 必要なポリシーを持つEKSクラスター用のIAMロール
  - AmazonEKSClusterPolicy
  - AmazonEKSServicePolicy
- 必要なポリシーを持つEKSノード用のIAMロール
  - AmazonEKSWorkerNodePolicy
  - AmazonEKS_CNI_Policy
  - AmazonEC2ContainerRegistryReadOnly
- EKSノード用のIAMインスタンスプロファイル

### EC2インスタンスコネクトエンドポイント
- プライベートサブネット内のインスタンスへの接続を可能にする

### 管理インスタンス
- kubectl管理用のEC2インスタンス
- 専用サブネット内のネットワークインターフェース
- クライアントのIPアドレスからのSSHアクセスを許可するセキュリティグループ
- 最小限の権限を持つIAMロールとインスタンスプロファイル

### 初期化
- 管理インスタンスにkubectlをセットアップするためのスクリプトを実行するlocal-execプロビジョナー

## アーキテクチャ

このセットアップでは、EKSクラスターはプライベートエンドポイントのみを持ち、パブリックインターネットからは直接アクセスできません。クラスターへのアクセスは、EC2インスタンスコネクトエンドポイントを介して管理インスタンスに接続し、そこからkubectlを使用して行います。

## 使用方法

このリソース構成をデプロイするには、メインのREADME.mdファイルの手順に従ってください。