# Amazon EKS クラスター構成

このTerraform構成は、AWSにAmazon EKSクラスターとkubectlアクセス用のEC2インスタンスを作成します。以下のリソースが含まれています：

![構成図](src/architecture.svg)

## リソース構成

### ネットワークリソース
- **VPC**: CIDRブロック10.0.0.0/16
- **サブネット**: 2つのパブリックサブネット（マルチAZ配置）
  - サブネット1: 10.0.0.0/24
  - サブネット2: 10.0.1.0/24
- **インターネットゲートウェイ**: インターネット接続用
- **ルートテーブル**: インターネットゲートウェイへのルート（0.0.0.0/0）
- **セキュリティグループ**: EKSクラスター用のアクセス制御

### EKSリソース
- **EKSクラスター**：
  - クラスター名: eks-study
  - Kubernetesバージョン: 1.27
  - プライベートエンドポイント: 有効
  - パブリックエンドポイント: 無効
  - マネージドノードグループ付き

- **EKSノードグループ**：
  - インスタンスタイプ: t2.micro
  - 最小サイズ: 0
  - 最大サイズ: 1
  - 希望サイズ: 0（デフォルト）
  - 自動スケーリング対応

### kubectl アクセス用インスタンス
- **EC2インスタンス**：
  - インスタンスタイプ: t2.micro
  - 専用サブネット: 10.0.10.0/24
  - kubectl CLI自動インストール
  - EKSクラスターアクセス用IAMロール付き

### IAMリソース
- **EKSクラスター用IAMロール**: EKSサービス実行権限
- **EKSノードグループ用IAMロール**: ワーカーノード実行権限
- **kubectl インスタンス用IAMロール**: EKSクラスターアクセス権限

## セキュリティ設計

- EKSクラスターはプライベートエンドポイントのみ有効
- kubectl アクセスは専用のEC2インスタンス経由
- 各コンポーネントは最小権限の原則に基づくIAMロール設定
- セキュリティグループでネットワークアクセス制御

## 使用方法

この構成をデプロイするには、メインのREADME.mdに記載されている手順に従ってください。

### デプロイ後の接続方法

1. kubectl インスタンスにSSH接続
2. AWS CLI設定（SSOロール使用）
3. EKSクラスターへの接続設定
4. kubectl コマンドでクラスター操作

## 注意事項

⚠️ **重要**: 
- デフォルト設定ではノードグループの希望サイズが0に設定されています
- 本番環境では適切なインスタンスタイプとスケーリング設定を行ってください
- SSOロール名は実際の環境に合わせて設定してください