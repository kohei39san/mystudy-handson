# EC2 踏み台サーバーとプライベートサーバーの構成

このTerraform構成は、AWSに踏み台ホストとプライベートサーバーを作成します。以下のリソースが含まれています：

![構成図](src/architecture.svg)

## リソース構成

### ネットワークリソース
- **VPC**: CIDRブロック10.0.0.0/16
- **踏み台ホスト用サブネット**: 10.0.0.0/24（パブリックIPアドレス自動割り当て有効）
- **プライベートサーバー用サブネット**: 10.0.1.0/24（パブリックIPアドレス自動割り当て有効）
- **インターネットゲートウェイ**: インターネット接続用
- **ルートテーブル**: インターネットゲートウェイへのルート（0.0.0.0/0）
- **踏み台ホスト用セキュリティグループ**: クライアントのグローバルIPからのSSH許可（ポート22）
- **プライベートサーバー用セキュリティグループ**: 踏み台ホストのプライベートIPからのみSSH許可（ポート22）

### コンピューティングリソース
- **踏み台ホストEC2インスタンス**：
  - Amazon Linux 2 AMI（SSMパラメータストアから動的取得）
  - 固定プライベートIP: 10.0.0.10
  - パブリックIPアドレス自動割り当て
  - クライアントのグローバルIPからのSSHアクセス許可（動的IP取得）
  - 専用ネットワークインターフェース使用

- **プライベートサーバーEC2インスタンス**：
  - Amazon Linux 2 AMI（SSMパラメータストアから動的取得）
  - 固定プライベートIP: 10.0.1.10
  - パブリックIPアドレス自動割り当て
  - 踏み台ホストのプライベートIPからのみSSHアクセス可能（セキュリティグループで制限）
  - 専用ネットワークインターフェース使用
  - 初期設定用のブートストラップスクリプト実行

### アクセス管理
- **キーペア**: 両インスタンスへのSSHアクセス用の共通キーペア

## セキュリティ設計

- プライベートサーバーは踏み台ホストのプライベートIPからのみSSHアクセス可能
- クライアントのグローバルIPアドレスを動的に取得し、踏み台ホストへのアクセスを制限
- 各インスタンスは専用のセキュリティグループで保護
- 両サーバーともパブリックIPを持つが、プライベートサーバーは踏み台経由でのアクセスのみ許可

## 使用方法

この構成をデプロイするには、メインのREADME.mdに記載されている手順に従ってください。