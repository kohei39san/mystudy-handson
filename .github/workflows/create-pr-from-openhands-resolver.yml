name: Create Pull Request From OpenHands Resolver

on: create

jobs:
  create-pr:
    if: ${{ contains(github.ref, 'refs/heads/openhands-fix-issue-') }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Set environment variables
        run: |
          echo "ISSUE_NUMBER=$(echo ${{ github.ref }} | grep -Eo 'openhands-fix-issue-[0-9]+' | cut -d'-' -f4)" >> $GITHUB_ENV
          echo "REPO_VISIBILITY=$(gh repo view --json visibility --jq .visibility)" >> $GITHUB_ENV
      - name: Create Pull Request
        if: env.REPO_VISIBILITY == 'PRIVATE' || github.event.label.name == 'fix-me-experimental'
        run: |
          gh pr create --title "Fix issue #${{ env.ISSUE_NUMBER }}: Automated PR for feature branch" --body "Fix issue #${{ env.ISSUE_NUMBER }}: This PR is auto-generated by GitHub Actions." --base ${{ vars.TARGET_BRANCH || 'main' }} --head "${GITHUB_REF#refs/heads/}"
    env:
      GH_TOKEN: ${{ secrets.PAT_TOKEN }}
      GITHUB_USER: ${{ secrets.PAT_USERNAME }}